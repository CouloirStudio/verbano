name: Run Tests

on:
  pull_request:
    branches: [main]
    types: [synchronize, opened, reopened]

jobs:
  test:
    name: Run Jest Tests
    runs-on: ubuntu-latest
    outputs:
      status: ${{ steps.set-test-output.outputs.status }}
    steps:
    - name: Check out repository code
      uses: actions/checkout@v2
    - name: Use Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '18.17.1'
    - name: Install dependencies
      run: yarn install --frozen-lockfile
    - name: Run frontend jest tests
      run: yarn test:frontend
    - id: set-test-output
      run: echo "::set-output name=status::success"
      if: success()
    - id: set-test-output-failure
      run: echo "::set-output name=status::failure"
      if: failure()

  create-summary:
    name: Create Job Summary for Test Results
    runs-on: ubuntu-latest
    steps:
    - name: Generate Test Job Summary
      run: |
        TEST_STATUS=${{ needs.test.outputs.status }}
        echo '### ðŸš€ Job Summary' >> $GITHUB_STEP_SUMMARY
        echo '- Frontend Jest tests result: **'$TEST_STATUS'**.' >> $GITHUB_STEP_SUMMARY
