name: CI

on:
  pull_request:
    branches: [ main ]

jobs:
  test:
    name: Run Jest Tests
    runs-on: ubuntu-latest

    steps:
    - name: Check out repository code
      uses: actions/checkout@v2

    - name: Use Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '18.17.1'

    - name: Install dependencies
      run: yarn install --frozen-lockfile

    - name: Run frontend jest tests
      run: yarn test:frontend

    - name: Run backend jest tests
      run: yarn test:backend

  create-summary:
    name: Create Job Summary
    runs-on: ubuntu-latest
    needs: [test]
    steps:
    - name: Check branch name and suggest tag
      id: branch_check
      run: |
        BRANCH_NAME=${GITHUB_REF#refs/heads/}
        echo "Branch name is $BRANCH_NAME"
        
        case $BRANCH_NAME in
          bug/*)
            echo "Suggested tag: bug"
            echo "::set-output name=tag::bug"
            ;;
          feature/*)
            echo "Suggested tag: feature"
            echo "::set-output name=tag::feature"
            ;;
          test/*)
            echo "Suggested tag: test"
            echo "::set-output name=tag::test"
            ;;
          *)
            echo "No specific tag suggestion based on branch name."
            echo "::set-output name=tag::none"
            ;;
        esac

    - name: Job summary
      run: |
        echo "Frontend and Backend Jest tests have been executed."
        echo "Reminder:"
        echo "1. Ensure your pull request branch is up to date with main."
        echo "2. Assign a reviewer to your pull request."
        if [ "${{ steps.branch_check.outputs.tag }}" != "none" ]; then
          echo "3. Consider adding the suggested tag: ${{ steps.branch_check.outputs.tag }}"
        else
          echo "3. Assign a meaningful tag to your pull request."
        fi
